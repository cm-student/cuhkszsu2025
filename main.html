<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>学生会工作证</title>
  <style>
    :root{
      --border: #000;
      --bg-top: #FFF4CC;   /* 乳黄色 */
      --bg-bottom: #BFA8FF;/* 淡紫色 */
      --panel: #ffffff;
      --purple: #A78BFA;
      --shadow: 0 10px 30px rgba(0,0,0,.12), inset 0 0 0 8px var(--border);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; display:grid; place-items:center; min-height:100svh;
      background: url("图层 1.png") no-repeat center/cover; font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
      overflow:hidden; /* 防止缩放后溢出出现滚动条 */
    }

    .wrap{ position:relative; padding-top:110px; }

    /* 固定舞台：通过等比缩放，在 9:16~9:21 竖屏上保持显示大小一致 */
    .stage{
      position:relative;
      width:max-content; /* 由内部实际尺寸决定 */
      height:max-content;
      transform:scale(var(--scale,1));
      transform-origin:top center;
    }
    .scene{ /* 标记用于测量原始尺寸，无需额外样式 */ }

    /* 吊绳 */
    .strap{
      position:absolute; left:50%; top:0; transform:translateX(-50%);
      width:80px; height:120px; background:#B69CFF;
      border-radius:6px;
    }
    .strap-notch{
      position:absolute; left:50%; top:96px; transform:translateX(-50%);
      width:110px; height:50px; background:#fff; border-radius:12px;
      box-shadow: inset 0 0 0 6px var(--border);
      z-index:2;
    }

    /* 证件卡 */
    .badge{
      position:relative; z-index:1;
      height:auto;
      width:360px;           /* 固定设计宽度，后续整体等比缩放 */
      aspect-ratio: 4/5.5;
      border-radius:24px; 
      background: linear-gradient(
        to bottom,
        var(--bg-top) 0%,
        var(--bg-top) 40%,
        var(--bg-bottom) 60%,
        var(--bg-bottom) 100%
      );
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex; flex-direction:column; gap:10px;
    }

    /* 顶部条：logo + 标题 */
    .top{ position:relative; padding:24px 28px 14px; }
    .title{
      font-weight:700; font-size: 30px;
      line-height:1.1;
      letter-spacing:2px; text-align:center; margin:10px 0 0;
    }
    .logo-line{ display:flex; align-items:center; gap:10px; font-size:12px; color:#5a3; }
    .logo-img{ width:200px; height:auto; display:block; }

    .info-row{ display:flex; gap: 16px; margin-top:22px; align-items:stretch; }
    .avatar{
      flex:0 0 100px; /* 固定宽度 */
      aspect-ratio: 3 / 4; /* 固定为 3:4 高宽比 */
      background:#fff; border-radius:16px; box-shadow: inset 0 0 0 4px var(--border);
      padding:8px; display:flex; align-items:stretch;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:12px; }
    .avatar svg{ width:100%; height:100%; }

    .fields{ flex:1; background:#fff; border-radius:16px; box-shadow: inset 0 0 0 4px var(--border);
      padding:16px 18px; display:grid; gap:14px;
      grid-template-rows: 1fr 1fr; /* 两行平均分配高度 */
      min-width:0; overflow:hidden;
    }
    .line{ display:flex; gap:10px; align-items:center; font-size:16px; white-space:nowrap; }
    .line strong{ flex:0 0 2.5em; }
    .underline{ height:2px; background:#111; flex:1; box-shadow: 0 6px 0 0 #111, 0 -6px 0 0 transparent; position:relative; }
    .underline::before{ content:""; position:absolute; left:0; right:0; top:-1px; height:0; border-top:2px solid #111; }

    .value{ flex:1; position:relative; min-height:26px; display:flex; align-items:center; min-width:6em; }
    .value::after{ content:""; position:absolute; left:0; right:6px; bottom:0; height:2px; background:#111; }
    .val-text{ position:relative; z-index:1; padding:0 6px; font-weight:600; display:inline-block; max-width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

    /* 能力面板 */
    .panel{
      position:relative; margin:0 28px 28px;
      background:var(--panel); border-radius:18px; box-shadow: inset 0 0 0 4px var(--border);
      padding:14px 18px 14px;
    }
    .panel h3{ margin:0 0 8px; text-align:center; font-size:22px; }

    .skills{
      display:grid;
      grid-template-columns: 1fr 2.2fr;
      gap:10px 10px;
      align-items:center;
    }
    .skill{ font-size:13px; white-space:nowrap; }
    .bar{
      height:16px; background:transparent; border:2px solid #111; border-radius:8px;
      padding:2px 34px 2px 2px; /* 为右侧分数预留空间 */
      display:flex; align-items:center; position:relative; overflow:hidden;
    }
    .bar .fill { background:#aaf; height:100%; border-radius:6px; max-width:100%; }
    .bar .score { position:absolute; right:8px; font-size:12px; font-weight:bold; }

    /* 外边黑框 */
    .badge::after{ content:""; position:absolute; inset:12px; border-radius:24px; box-shadow: inset 0 0 0 4px var(--border); z-index:0; pointer-events:none; }
    .top, .panel{ z-index:1; }

    @media (max-width:420px) and (orientation: landscape){
      .avatar{flex-basis:100px; aspect-ratio: 3 / 4;}
      .fields{gap:10px}
      .skills{ grid-template-columns: 1fr 2fr; gap:6px 8px; }
      .skill{ font-size:11px; white-space:nowrap; }
      .bar{ height:14px; border-width:2px; padding:2px 30px 2px 2px; }
      .bar .score{ font-size:11px; right:6px; }
      .top{ padding-bottom:10px; }
      .title{ font-size:32px; line-height:1.05; margin-top:2px; }
      .info-row{ margin-top:18px; }
      .panel{ padding-top:12px; }
      .panel h3{ margin-bottom:6px; }
    }
  </style>
  <script>
    window.DEFAULT_PHOTO = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="400" viewBox="0 0 300 400"><rect width="100%" height="100%" fill="%23fff"/><rect x="10" y="10" width="280" height="380" rx="18" fill="none" stroke="%23000" stroke-width="4"/><circle cx="150" cy="140" r="60" fill="%23999"/><rect x="60" y="220" width="180" height="120" rx="24" fill="%23999"/></svg>';
  </script>
</head>
<body>
  <div class="stage"><div class="wrap scene">
    <div class="strap" aria-hidden="true"></div>
    <div class="strap-notch" aria-hidden="true"></div>

    <main class="badge" role="group" aria-label="学生会工作证">
      <section class="top">
        <div class="logo-line" aria-label="学校标识">
          <img src="CUHK-Shenzhen.png" alt="学校Logo" class="logo-img" />
        </div>
        <h1 class="title">学生会工作证</h1>

        <div class="info-row" aria-label="基本信息">
          <div class="avatar" aria-hidden="true">
            <img id="avatar-img" alt="头像" />
          </div>
          <div class="fields">
            <div class="line"><strong>姓名</strong><div class="value"><span id="nameText" class="val-text"></span></div></div>
            <div class="line"><strong>部门</strong><div class="value"><span id="deptText" class="val-text"></span></div></div>
          </div>
        </div>
      </section>

      <section class="panel" aria-label="我的能力">
        <h3>我的能力</h3>
        <div class="skills">
          <div class="skill">续航能力</div> <div class="bar"><div class="fill"></div><span class="score"></span></div>
          <div class="skill">灵感爆发力</div> <div class="bar"><div class="fill"></div><span class="score"></span></div>
          <div class="skill">社交能力</div> <div class="bar"><div class="fill"></div><span class="score"></span></div>
          <div class="skill">拖延能力</div> <div class="bar"><div class="fill"></div><span class="score"></span></div>
        </div>
      </section>
    </main>
  </div>
  </div>
  <script>
    (function(){
      const data = localStorage.getItem('su_photo_dataurl') || window.DEFAULT_PHOTO;
      const img = document.getElementById('avatar-img');
      if(img){ img.src = data; }
    })();
    // 等比缩放：在 9:16~9:21 的竖屏上保持“视觉大小”一致
    function fitStage(){
      const stage = document.querySelector('.stage');
      const scene = document.querySelector('.scene') || document.querySelector('.wrap');
      if(!stage || !scene) return;
      // 先复位 scale 以测量原始大小
      stage.style.setProperty('--scale', 1);
      const rect = scene.getBoundingClientRect();
      const vh = window.innerHeight;
      const rMin = 9/21; // 最窄竖屏宽高比
      // 基于高度的缩放，再乘以一个固定系数，保证在 9:21 下刚好不超宽；
      // 因此在 9:16~9:21 范围内获得相同的可视尺寸（所有元素等比缩放）。
      const s = (vh / rect.height) * (rMin * rect.height / rect.width) * 0.98; // 0.98 留一点边距
      stage.style.setProperty('--scale', s);
    }
    window.addEventListener('load', fitStage);
    window.addEventListener('resize', fitStage, { passive: true });

    (function(){
      const p = new URLSearchParams(location.search);
      const name = p.get('name') || '';
      const dept = p.get('dept') || '';
      const nameEl = document.getElementById('nameText');
      const deptEl = document.getElementById('deptText');
      if(nameEl) nameEl.textContent = name || '（未填写）';
      if(deptEl) deptEl.textContent = dept || '（未填写）';
    })();
    document.querySelectorAll('.bar').forEach(bar=>{
      const score = Math.floor(Math.random() * 61) + 40; // 40-100
      const fill = bar.querySelector('.fill');
      const label = bar.querySelector('.score');
      fill.style.width = score + '%';
      label.textContent = score;
    });
  </script>
</body>
</html>